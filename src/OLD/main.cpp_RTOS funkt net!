

#include "M5Atom.h"
#include "GPSAnalyse.h"

GPSAnalyse GPS;

HardwareSerial GPSRaw(2);

float Lat;
float Lon;
String Utc;

void setup()
{

  M5.begin(true, false, true);

  M5.dis.fillpix(0x00004f);

  // Serial1.begin(9600,SERIAL_8N1,22,-1);
  // Serial1.begin(9600, SERIAL_8N1, 26, -1);
  GPSRaw.begin(9600, SERIAL_8N1, 32, 26);
  GPS.setTaskName("GPS");
  GPS.setTaskPriority(2);
  GPS.setSerialPtr(GPSRaw);
  GPS.start();
  Serial.println("hello");
}

void loop()
{
  GPS.upDate();
  Lat = GPS.s_GNRMC.Latitude;
  Lon = GPS.s_GNRMC.Longitude;
  Utc = GPS.s_GNRMC.Utc;

  Serial.printf("Latitude= %.5f \r\n", Lat);
  Serial.printf("Longitude= %.5f \r\n", Lon);
  Serial.print("Time=");
  Serial.println(Utc);
  delay(1000);

  // if (Serial.available())
  // {
  //   int ch = Serial.read();
  //   Serial.write(ch); // echo
  //   GPSRaw.write(ch);
  // }

  // if (GPSRaw.available())
  // {
  //   int ch = GPSRaw.read();
  //   Serial.write(ch);
  // }
}
